openapi: 3.0.0
info:
  title: Bank API
  version: 1.0.0
  description: API documentation
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
paths:
  /users/login:
    post:
      summary: Sign-in User
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  example: newuser
                password:
                  type: string
                  example: securepassword
      responses:
        '200':
          description: Login successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  message:
                    type: string
                    example: Login successful
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Invalid credentials
  /users/register:
    post:
      summary: Register User
      tags:
        - Users
      requestBody:                     
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  example: newuser
                email:
                  type: string
                  example: example@email.com
                firstName:
                  type: string
                  example: John
                lastName:
                  type: string
                  example: Doe
                telephoneNumber:
                  type: string
                  example: +123456789
                password:
                  type: string
                  example: securepassword
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User and account created successfully
                  accountId:
                    type: string
                    example: 64a7b2f5e4b0c8a1d2f3g4h5
                  userId:
                    type: string
                    example: 64a7b2f5e4b0c8a1d2f3g4h5
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        '400':
          description: Bad request
        '409':
          description: Conflict, provided value already exists
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: TelephoneNumber already in use
  /transactions/make-transaction:
    post:
      summary: Send Transaction
      tags:
        - Transactions
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - recipientName
                - fromIban
                - toIban
                - amount
                - currency
              properties:
                recipientName:
                  type: string
                  example: John Doe
                amount:
                  type: number
                  example: 100.50
                description:
                  type: string
                  example: Payment for services
                currency:
                  type: string
                  example: EUR
                fromIban:
                  type: string
                  example: EX14114020040000300201311111
                toIban:
                  type: string
                  example: EX14114020040000300201312222
      responses:
        '201':
          description: Transaction successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Transaction successful
                  transactionId:
                    type: string
                    example: 64a7b2f5e4b0c8a1d2f3g4h5
                  amount:
                    type: number
                    example: 100.50
                  currency:
                    type: string
                    example: EUR
                  status:
                    type: string
                    example: pending
                  xml:
                    type: string
                    example: <FIToFICustomerCreditTransfer>...</FIToFICustomerCreditTransfer>
        '400':
          description: Bad request (validation error, insufficient funds, currency mismatch)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Insufficient funds
        '401':
          description: Unauthorized, user not authenticated
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized access
        '404':
          description: Account or IBAN not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Recipient IBAN not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Error with sending transaction
  /history:
    get:
      summary: Get transaction history for account
      tags:
        - History
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: iban
          required: true
          schema:
            type: string
          description: IBAN of the account
        - in: query
          name: startDate
          required: true
          schema:
            type: string
            format: date
          description: Start date (YYYY-MM-DD)
        - in: query
          name: endDate
          required: true
          schema:
            type: string
            format: date
          description: End date (YYYY-MM-DD)
      responses:
        '200':
          description: List of transactions for the account in the given date range
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    transactionId:
                      type: string
                    fromIban:
                      type: string
                    toIban:
                      type: string
                    amount:
                      type: number
                    currency:
                      type: string
                    description:
                      type: string
                    status:
                      type: string
                    createdAt:
                      type: string
                      format: date-time
        '400':
          description: Invalid parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
  /accounts:
    get:
      summary: Get accounts for current user
      tags:
        - Accounts
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Accounts for the authenticated user
          content:
            application/json:
              schema:
                type: object
                properties:
                  _id:
                    type: string
                    example: 64a7b2f5e4b0c8a1d2f3g4h5
                  iban:
                    type: string
                    example: EX14114020040000300201311111
                  balance:
                    type: number
                    example: 1000.50
                  currency:
                    type: string
                    example: EUR
                  userId:
                    type: string
                    example: 64a7b2f5e4b0c8a1d2f3g4h5
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Invalid request
        '401':
          description: Unauthorized access
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized access
        '404':
          description: Account not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Account not found
  /accounts/create:
    post:
      summary: Create a new account for an existing user
      tags:
        - Accounts
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                  example: 64a7b2f5e4b0c8a1d2f3g4h5
                currency:
                  type: string
                  example: EUR
      responses:
        '201':
          description: Account created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Account created successfully
                  accountId:
                    type: string
                    example: 64a7b2f5e4b0c8a1d2f3g4h5
                  iban:
                    type: string
                    example: EX14114020040000300201312222
                  balance:
                    type: number
                    example: 500.00
                  currency:
                    type: string
                    example: EUR
        '400':
          description: Bad request (validation error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Invalid user ID
        '401':
          description: Unauthorized access
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized access
        '404':
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: User not found

  /admin/logs:
    get:
      summary: Admin - list account balance change logs
      description: Returns audit logs of balance changes. Admin only.
      tags:
        - Admin
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: userId
          schema:
            type: string
          description: Filter by user ID
        - in: query
          name: accountId
          schema:
            type: string
          description: Filter by account ID
        - in: query
          name: iban
          schema:
            type: string
          description: Filter by IBAN
        - in: query
          name: action
          schema:
            type: string
            enum: [deposit, withdrawal, transfer]
          description: Filter by action type
        - in: query
          name: startDate
          schema:
            type: string
            format: date-time
          description: Include logs from this date/time (ISO 8601)
        - in: query
          name: endDate
          schema:
            type: string
            format: date-time
          description: Include logs up to this date/time (ISO 8601)
      responses:
        '200':
          description: List of account logs
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          example: 66f1a2b3c4d5e6f7a8b9c0d1
                        userId:
                          type: string
                        accountId:
                          type: string
                        action:
                          type: string
                          enum: [deposit, withdrawal, transfer]
                        timestamp:
                          type: string
                          format: date-time
                        iban:
                          type: string
                        beforeBalance:
                          type: number
                        afterBalance:
                          type: number
                        description:
                          type: string
                        createdAt:
                          type: string
                          format: date-time
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: No token provided
        '403':
          description: Forbidden - admin role required
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Insufficient permissions
  /admin/login:
    post:
      summary: Admin Login
      tags:
        - Admin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  example: adminuser
                password:
                  type: string
                  example: adminpassword
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  token:
                    type: string  
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  message:
                    type: string
                    example: Login successful
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Invalid credentials
  /admin/create:
    post:
      summary: Create Admin User
      tags:
        - Admin
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  example: newadmin
                password:
                  type: string
                  example: newadminpassword
      responses:
        '201':
          description: Admin user created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Admin user created successfully
        '400':
          description: Bad request (validation error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Username already exists
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Unauthorized access
        